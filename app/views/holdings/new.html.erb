<%# app/views/holdings/new.html.erb %>
<%= turbo_frame_tag "new_holding" do %>
  <div class="bg-white rounded-lg border-green-600 border-solid border-2 shadow-lg p-6">
    <h2><%= @holding.persisted? ? "Edit" : "New" %> Holding</h2>

    <%= form_with(model: [@portfolio, @holding], local: true) do |form| %>
      <% if @holding.errors.any? %>
        <div class="alert alert-danger">
          <h4><%= pluralize(@holding.errors.count, "error") %> prohibited this holding from being saved:</h4>
          <ul>
            <% @holding.errors.full_messages.each do |message| %>
              <li><%= message %></li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <div class="form-group">
        <%= form.label :security_id, "Security" %>
        <%= form.collection_select :security_id, @securities, :id, :display_name, 
                                  { prompt: "Select a security" }, 
                                  { class: "form-control" } %>
        <small class="form-text text-muted">
          Showing securities from <%= @portfolio.currency&.country || "all countries" %>
        </small>
      </div>

      <div class="form-group">
        <%= form.label :quantity %>
        <%= form.number_field :quantity, step: 'any', class: "form-control" %>
      </div>

      <div class="form-group">
        <%= form.label :cost_basis, "Cost Basis" %>
        <%= form.number_field :cost_basis, step: 'any', class: "form-control" %>
        <small class="form-text text-muted">
          Cost basis in the security's native currency
        </small>
      </div>

      <div class="form-actions">
        <%= form.submit class: "btn btn-primary" %>
        <%= link_to "Cancel", portfolio_path(@portfolio), class: "btn btn-secondary" %>
      </div>
    <% end %>
  </div>
<% end %>